{"ast":null,"code":"var _jsxFileName = \"/home/turbo/devel/MyGame/contracts/eos-hackathon/decentralize-io-ui/src/components/Pages/Organisations/Voting/Voting.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport VotingCard from './VotingCard';\nimport moment from 'moment';\nimport VotingDetails from \"./VotingDetails\";\nimport EOSIOApi from '../../../../common/eosio-apiService';\nimport { REACT_APP_EOSIO_CONTRACT_ACCOUNT } from \"../../../../common/config\";\nimport DateRangePicker from 'react-bootstrap-daterangepicker';\nimport './Voting.css';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport 'bootstrap-daterangepicker/daterangepicker.css';\nimport { votingHeader1, votingHeader } from \"./VotingFilters\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Voting = props => {\n  _s();\n\n  const myRef = useRef();\n  const [data1, setData1] = useState([]);\n  const [startDate, setStartDate] = useState(null);\n  const [votingDtls, setVotingDtls] = useState(false);\n  const [openDropBox, setOpenDropDown] = useState(false);\n  const [activeDroxKey, setActiveDroxKey] = useState(null);\n  const [selectedDates, setSelectedDates] = useState(null);\n  const [votingDtlsData, setVotingDtlsData] = useState({});\n  const [votinQuestionList, setvotinQuestionList] = useState([]);\n  const [votingHeaders, setVotingHeaders] = useState(votingHeader);\n  const [isDropDownSelected, setDropDownSelected] = useState(false);\n  const [selectedFilters, setFilters] = useState({\n    Status: '',\n    Outcome: '',\n    Type: ''\n  });\n  const eosio = new EOSIOApi(REACT_APP_EOSIO_CONTRACT_ACCOUNT, props.activeUser);\n\n  const handleClose = () => setVotingDtls(false);\n\n  const openVotingDtls = votings => {\n    setVotingDtls(true);\n    setVotingDtlsData(votings.voteQuestionDtls);\n  };\n\n  const openDropDown = data => {\n    setOpenDropDown(true);\n    setActiveDroxKey(data.key);\n  };\n\n  const setSelectedValue = async (e, option, data) => {\n    e.stopPropagation();\n    setDropDownSelected(true);\n    let votingFilters = JSON.parse(JSON.stringify(selectedFilters));\n    votingHeader.filter(obj => obj.key === data.key)[0].selectedValue = option.key;\n    votingFilters[data.key.trim()] = option.value;\n    let updatedVotingList = await filterVotes(votingFilters);\n    setvotinQuestionList(updatedVotingList);\n    setFilters(votingFilters);\n    setVotingHeaders(votingHeader);\n    setOpenDropDown(false);\n  };\n\n  const filterVotes = (votingFilters, created = selectedDates) => {\n    let filterLength = 0,\n        filterNeedToTest = [],\n        updatedVotingList = [],\n        votingData1 = JSON.parse(JSON.stringify(data1));\n\n    for (const [prop, val] of Object.entries(votingFilters)) {\n      if (val !== 'all' && val !== '') filterNeedToTest.push({\n        key: prop.toLowerCase(),\n        value: val\n      });\n    }\n\n    filterLength = filterNeedToTest.length;\n\n    if (filterLength > 0 || created !== null) {\n      for (let z = 0; z < votingData1.length; z++) {\n        let obj = votingData1[z];\n        let breakFlag = false;\n\n        if (created != null) {\n          if (moment(obj.created).utc().format(\"MM/DD/YYYY\") >= created.startDate && moment(obj.created).utc().format(\"MM/DD/YYYY\") <= created.endDate) {\n            if (filterLength === 0) {\n              breakFlag = true;\n            } else {\n              if (filterLength === 1 && obj[filterNeedToTest[0].key] === filterNeedToTest[0].value) {\n                breakFlag = true;\n              } else if (filterLength === 2 && obj[filterNeedToTest[0].key] === filterNeedToTest[0].value && obj[filterNeedToTest[1].key] === filterNeedToTest[1].value) {\n                breakFlag = true;\n              } else if (filterLength === 3 && obj[filterNeedToTest[0].key] === filterNeedToTest[0].value && obj[filterNeedToTest[1].key] === filterNeedToTest[1].value && obj[filterNeedToTest[2].key] === filterNeedToTest[2].value) {\n                breakFlag = true;\n              }\n            }\n          }\n        } else {\n          if (filterLength === 1 && obj[filterNeedToTest[0].key] === filterNeedToTest[0].value) {\n            breakFlag = true;\n          } else if (filterLength === 2 && obj[filterNeedToTest[0].key] === filterNeedToTest[0].value && obj[filterNeedToTest[1].key] === filterNeedToTest[1].value) {\n            breakFlag = true;\n          } else if (filterLength === 3 && obj[filterNeedToTest[0].key] === filterNeedToTest[0].value && obj[filterNeedToTest[1].key] === filterNeedToTest[1].value && obj[filterNeedToTest[2].key] === filterNeedToTest[2].value) {\n            breakFlag = true;\n          }\n        }\n\n        if (breakFlag) updatedVotingList.push(obj);\n        if (z === votingData1.length - 1) return updatedVotingList;\n      }\n    } else {\n      updatedVotingList = votingData1;\n      return updatedVotingList;\n    }\n  };\n\n  const handleClickOutside = e => {\n    if (!myRef.current.contains(e.target)) {\n      openDropDown(false);\n    }\n  };\n\n  const handleEvent = (event, picker) => {};\n\n  const handleCallback = async (start, end, label) => {\n    setSelectedDates({\n      startDate: moment(start).format(\"MM/DD/YYYY\"),\n      endDate: moment(end).format(\"MM/DD/YYYY\")\n    });\n    let updatedVotingList = await filterVotes(selectedFilters, {\n      startDate: moment(start).format(\"MM/DD/YYYY\"),\n      endDate: moment(end).format(\"MM/DD/YYYY\")\n    });\n    setvotinQuestionList(updatedVotingList);\n  };\n\n  const enactAmount = async vote => {\n    let response = await eosio.transaction(props.activeEosAccount, 'exectknprp', {\n      id: vote.id\n    });\n    if (!(response && response.length > 0 && response[0].isError)) window.location.reload();\n  };\n\n  const votedQuestion = async (votingData, isVoted) => {\n    let response = null,\n        token = props.daoList.filter(dao => dao.data.id === votingData.daoid)[0].data.token.split(' ')[1],\n        vote = {\n      id: votingData.id,\n      voter: props.activeEosAccount,\n      tkn: `0 ${token}`,\n      choice: isVoted\n    };\n    if (votingData.type === 'Shareholders') response = await eosio.transaction(props.activeEosAccount, 'votetknprp', { ...vote\n    });else response = await eosio.transaction(props.activeEosAccount, 'votevotprp', { ...vote\n    });\n    setVotingDtls(false);\n    if (!(response && response.length > 0 && response[0].isError)) window.location.reload();\n  };\n\n  const getVotingList = async () => {\n    try {\n      let j = 0,\n          data1 = [],\n          votingList = [],\n          votingListResponse = await new EOSIOApi(REACT_APP_EOSIO_CONTRACT_ACCOUNT).getTableRows('bigpicturesw', 'bigpicturesw', 'votingprp', 0, props.totalVotings, props.totalVotings),\n          shareholdersVotingListResponse = await new EOSIOApi(REACT_APP_EOSIO_CONTRACT_ACCOUNT).getTableRows('bigpicturesw', 'bigpicturesw', 'tokenprp', 0, props.totalVotings, props.totalVotings);\n\n      if (votingListResponse.data.rows.length > 0) {\n        let data = JSON.parse(JSON.stringify(votingListResponse.data.rows));\n        data.map(el => votingList.push(el.data));\n      }\n\n      if (shareholdersVotingListResponse.data.rows.length > 0) {\n        let data = JSON.parse(JSON.stringify(shareholdersVotingListResponse.data.rows));\n        data.map(el => votingList.push(el.data));\n      }\n\n      if (votingList.length > 0) {\n        votingList.sort((a, b) => new Date(b.created) - new Date(a.created));\n        setStartDate(moment(votingList[votingList.length - 1].created).format(\"MM/DD/YYYY\"));\n      }\n\n      for (j = 0; j < votingList.length; j++) {\n        let item = JSON.parse(JSON.stringify(votingList[j])),\n            totalVote = item.yes + item.no,\n            voteDAO = props.daoList.filter(dao => dao.data.id === item.daoid)[0],\n            token = voteDAO.data.token.split(' ')[1],\n            isTokenAvailable = props.daotokensList.filter(dao => dao.data.balance.split(' ')[1] === token);\n\n        if (item.question) {\n          item.type = 'Voting';\n          item.title = 'Voting';\n        } else {\n          item.type = 'Shareholders';\n          item.title = 'Sharevolder';\n          item.question = `This proposal will distribute ${item.amount} to ${item.user}`;\n        }\n\n        console.log(\"item::\", item);\n        console.log(\"token::\", token);\n        console.log(\"isTokenAvailable::\", isTokenAvailable);\n        if (isTokenAvailable.length > 0) item.canIVote = true;else item.canIVote = false;\n        item.contentId = j + 1;\n        item.yesPerc = totalVote === 0 ? 0 : (item.yes / totalVote * 100).toFixed(2);\n        item.noPerc = totalVote === 0 ? 0 : (item.no / totalVote * 100).toFixed(2);\n\n        if (moment(moment.utc(item.expires).format()).isAfter(moment.utc().format())) {\n          item.outcome = 'Pending';\n          item.status = 'Open';\n        } else {\n          item.status = 'Closed';\n\n          if (item.yesPerc >= voteDAO.data.support) {\n            item.outcome = 'Passed';\n\n            if (!moment(moment.utc(item.expires).format()).isAfter(moment.utc().format()) && item.type === 'Shareholders' && item.paid === 1) {\n              item.outcome = 'Passed & Enacted';\n            }\n          } else if (item.yesPerc < voteDAO.data.support) {\n            item.outcome = 'Rejected';\n          }\n        }\n\n        data1.push(item);\n\n        if (j === votingList.length - 1) {\n          setData1(data1);\n          setvotinQuestionList(data1);\n        }\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  useEffect(() => {\n    getVotingList();\n    setFilters({\n      Status: '',\n      Outcome: '',\n      Type: ''\n    });\n    setVotingHeaders(votingHeader1);\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"voting_main\",\n    ref: myRef,\n    onClick: handleClickOutside,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"voting_header\",\n      children: [votingHeaders.map((obj, k) => /*#__PURE__*/_jsxDEV(\"div\", {\n        id: obj.key,\n        name: obj.key,\n        className: \"dropdown voting-status\",\n        onClick: () => openDropDown(obj),\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"votingstatus-text\",\n          children: obj.selectedValue\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"fa fa-angle-down votingstatus-down\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 254,\n            columnNumber: 31\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 25\n        }, this), openDropBox && activeDroxKey === obj.key && /*#__PURE__*/_jsxDEV(\"ul\", {\n          className: \"options\",\n          style: obj.style,\n          children: obj.data.length > 0 && obj.data.map((opt, i) => /*#__PURE__*/_jsxDEV(\"li\", {\n            \"data-value\": `${opt.value}`,\n            onClick: e => setSelectedValue(e, opt, obj),\n            children: opt.key\n          }, i, false, {\n            fileName: _jsxFileName,\n            lineNumber: 258,\n            columnNumber: 37\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 29\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 21\n      }, this)), startDate != null && /*#__PURE__*/_jsxDEV(DateRangePicker, {\n        onEvent: handleEvent,\n        onCallback: handleCallback,\n        initialSettings: {\n          startDate: selectedDates === null ? startDate : selectedDates.startDate,\n          endDate: selectedDates === null ? moment().utc().format(\"MM/DD/YYYY\") : selectedDates.startDate\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"dropdown voting-status\",\n          style: {\n            width: 'max-content'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"votingstatus-text\",\n            style: {\n              paddingRight: '51px'\n            },\n            children: selectedDates === null ? `Start | End` : `${selectedDates.startDate} | ${'  '}${selectedDates.endDate}`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 276,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: /*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"fa fa-angle-down votingstatus-down\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 279,\n              columnNumber: 35\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 279,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 275,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"voting_body\",\n      children: votinQuestionList.length > 0 && votinQuestionList.map((obj, l) => /*#__PURE__*/_jsxDEV(VotingCard, {\n        id: l,\n        voteQuestionDtls: obj,\n        votingDtls: votingDtls,\n        openVotingDtls: votings => openVotingDtls(votings)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 286,\n        columnNumber: 21\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 13\n    }, this), votingDtls && Object.keys(votingDtlsData).length > 0 && /*#__PURE__*/_jsxDEV(VotingDetails, {\n      show: votingDtls,\n      votingDtlsData: votingDtlsData,\n      handleClose: () => handleClose(),\n      enactAmount: vote => enactAmount(vote),\n      votedQuestion: (votingData, isVoted) => votedQuestion(votingData, isVoted)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 295,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 245,\n    columnNumber: 9\n  }, this);\n};\n\n_s(Voting, \"d9s2BY5pf61EtsumnRvxNeTGkOY=\");\n\n_c = Voting;\nexport default Voting;\n\nvar _c;\n\n$RefreshReg$(_c, \"Voting\");","map":{"version":3,"sources":["/home/turbo/devel/MyGame/contracts/eos-hackathon/decentralize-io-ui/src/components/Pages/Organisations/Voting/Voting.js"],"names":["React","useEffect","useRef","useState","VotingCard","moment","VotingDetails","EOSIOApi","REACT_APP_EOSIO_CONTRACT_ACCOUNT","DateRangePicker","votingHeader1","votingHeader","Voting","props","myRef","data1","setData1","startDate","setStartDate","votingDtls","setVotingDtls","openDropBox","setOpenDropDown","activeDroxKey","setActiveDroxKey","selectedDates","setSelectedDates","votingDtlsData","setVotingDtlsData","votinQuestionList","setvotinQuestionList","votingHeaders","setVotingHeaders","isDropDownSelected","setDropDownSelected","selectedFilters","setFilters","Status","Outcome","Type","eosio","activeUser","handleClose","openVotingDtls","votings","voteQuestionDtls","openDropDown","data","key","setSelectedValue","e","option","stopPropagation","votingFilters","JSON","parse","stringify","filter","obj","selectedValue","trim","value","updatedVotingList","filterVotes","created","filterLength","filterNeedToTest","votingData1","prop","val","Object","entries","push","toLowerCase","length","z","breakFlag","utc","format","endDate","handleClickOutside","current","contains","target","handleEvent","event","picker","handleCallback","start","end","label","enactAmount","vote","response","transaction","activeEosAccount","id","isError","window","location","reload","votedQuestion","votingData","isVoted","token","daoList","dao","daoid","split","voter","tkn","choice","type","getVotingList","j","votingList","votingListResponse","getTableRows","totalVotings","shareholdersVotingListResponse","rows","map","el","sort","a","b","Date","item","totalVote","yes","no","voteDAO","isTokenAvailable","daotokensList","balance","question","title","amount","user","console","log","canIVote","contentId","yesPerc","toFixed","noPerc","expires","isAfter","outcome","status","support","paid","error","document","addEventListener","removeEventListener","k","style","opt","i","width","paddingRight","l","keys"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport VotingCard from './VotingCard';\nimport moment from 'moment';\nimport VotingDetails from \"./VotingDetails\";\nimport EOSIOApi from '../../../../common/eosio-apiService';\nimport { REACT_APP_EOSIO_CONTRACT_ACCOUNT } from \"../../../../common/config\";\nimport DateRangePicker from 'react-bootstrap-daterangepicker';\nimport './Voting.css'\nimport 'bootstrap/dist/css/bootstrap.css';\nimport 'bootstrap-daterangepicker/daterangepicker.css';\nimport { votingHeader1, votingHeader } from \"./VotingFilters\";\n\nconst Voting = (props) => {\n    const myRef = useRef();\n    const [data1, setData1] = useState([]);\n    const [startDate, setStartDate] = useState(null);\n    const [votingDtls, setVotingDtls] = useState(false);\n    const [openDropBox, setOpenDropDown] = useState(false);\n    const [activeDroxKey, setActiveDroxKey] = useState(null);\n    const [selectedDates, setSelectedDates] = useState(null);\n    const [votingDtlsData, setVotingDtlsData] = useState({});\n    const [votinQuestionList, setvotinQuestionList] = useState([]);\n    const [votingHeaders, setVotingHeaders] = useState(votingHeader);\n    const [isDropDownSelected, setDropDownSelected] = useState(false);\n    const [selectedFilters, setFilters] = useState({ Status: '', Outcome: '', Type: '' });\n    const eosio = new EOSIOApi(REACT_APP_EOSIO_CONTRACT_ACCOUNT, props.activeUser);\n\n    const handleClose = () => setVotingDtls(false);\n\n    const openVotingDtls = (votings) => {\n        setVotingDtls(true)\n        setVotingDtlsData(votings.voteQuestionDtls)\n    };\n\n\n    const openDropDown = data => {\n        setOpenDropDown(true)\n        setActiveDroxKey(data.key)\n    }\n\n    const setSelectedValue = async (e, option, data) => {\n        e.stopPropagation();\n        setDropDownSelected(true)\n        let votingFilters = JSON.parse(JSON.stringify(selectedFilters))\n        votingHeader.filter(obj => obj.key === data.key)[0].selectedValue = option.key\n        votingFilters[(data.key).trim()] = option.value\n        let updatedVotingList = await filterVotes(votingFilters)\n        setvotinQuestionList(updatedVotingList)\n        setFilters(votingFilters)\n        setVotingHeaders(votingHeader)\n        setOpenDropDown(false)\n    }\n\n    const filterVotes = (votingFilters, created = selectedDates) => {\n        let filterLength = 0,\n            filterNeedToTest = [],\n            updatedVotingList = [],\n            votingData1 = JSON.parse(JSON.stringify(data1))\n\n        for (const [prop, val] of Object.entries(votingFilters)) {\n            if (val !== 'all' && val !== '')\n                filterNeedToTest.push({ key: (prop).toLowerCase(), value: val })\n        }\n\n        filterLength = filterNeedToTest.length\n\n        if (filterLength > 0 || created !== null) {\n            for (let z = 0; z < votingData1.length; z++) {\n                let obj = votingData1[z]\n                let breakFlag = false\n                if (created != null) {\n                    if (moment(obj.created).utc().format(\"MM/DD/YYYY\") >= created.startDate\n                        && moment(obj.created).utc().format(\"MM/DD/YYYY\") <= created.endDate) {\n                        if (filterLength === 0) {\n                            breakFlag = true\n                        } else {\n                            if (filterLength === 1\n                                && obj[filterNeedToTest[0].key] === filterNeedToTest[0].value) {\n                                breakFlag = true;\n                            } else if (filterLength === 2\n                                && obj[filterNeedToTest[0].key] === filterNeedToTest[0].value\n                                && obj[filterNeedToTest[1].key] === filterNeedToTest[1].value) {\n                                breakFlag = true;\n                            } else if (filterLength === 3\n                                && obj[filterNeedToTest[0].key] === filterNeedToTest[0].value\n                                && obj[filterNeedToTest[1].key] === filterNeedToTest[1].value\n                                && obj[filterNeedToTest[2].key] === filterNeedToTest[2].value) {\n                                breakFlag = true;\n                            }\n                        }\n                    }\n\n                } else {\n                    if (filterLength === 1\n                        && obj[filterNeedToTest[0].key] === filterNeedToTest[0].value) {\n                        breakFlag = true;\n                    } else if (filterLength === 2\n                        && obj[filterNeedToTest[0].key] === filterNeedToTest[0].value\n                        && obj[filterNeedToTest[1].key] === filterNeedToTest[1].value) {\n                        breakFlag = true;\n                    } else if (filterLength === 3\n                        && obj[filterNeedToTest[0].key] === filterNeedToTest[0].value\n                        && obj[filterNeedToTest[1].key] === filterNeedToTest[1].value\n                        && obj[filterNeedToTest[2].key] === filterNeedToTest[2].value) {\n                        breakFlag = true;\n                    }\n                }\n                if (breakFlag)\n                    updatedVotingList.push(obj)\n                if (z === votingData1.length - 1)\n                    return updatedVotingList\n            }\n        } else {\n            updatedVotingList = votingData1\n            return updatedVotingList\n        }\n    }\n\n    const handleClickOutside = e => {\n        if (!myRef.current.contains(e.target)) {\n            openDropDown(false);\n        }\n    };\n\n    const handleEvent = (event, picker) => {\n    }\n\n    const handleCallback = async (start, end, label) => {\n        setSelectedDates({ startDate: moment(start).format(\"MM/DD/YYYY\"), endDate: moment(end).format(\"MM/DD/YYYY\") })\n        let updatedVotingList = await filterVotes(\n            selectedFilters,\n            {\n                startDate: moment(start).format(\"MM/DD/YYYY\"),\n                endDate: moment(end).format(\"MM/DD/YYYY\")\n            })\n        setvotinQuestionList(updatedVotingList)\n    }\n\n    const enactAmount = async (vote) => {\n        let response = await eosio.transaction(props.activeEosAccount, 'exectknprp', { id: vote.id })\n        if (!(response && response.length > 0 && response[0].isError))\n            window.location.reload();\n    }\n\n    const votedQuestion = async (votingData, isVoted) => {\n        let response = null,\n            token = props.daoList.filter((dao) => dao.data.id === votingData.daoid)[0].data.token.split(' ')[1],\n            vote = { id: votingData.id, voter: props.activeEosAccount, tkn: `0 ${token}`, choice: isVoted }\n\n        if (votingData.type === 'Shareholders')\n            response = await eosio.transaction(props.activeEosAccount, 'votetknprp', { ...vote })\n        else\n            response = await eosio.transaction(props.activeEosAccount, 'votevotprp', { ...vote })\n\n        setVotingDtls(false)\n\n        if (!(response && response.length > 0 && response[0].isError))\n            window.location.reload();\n    }\n\n    const getVotingList = async () => {\n        try {\n            let j = 0,\n                data1 = [],\n                votingList = [],\n                votingListResponse = await new EOSIOApi(REACT_APP_EOSIO_CONTRACT_ACCOUNT).getTableRows('bigpicturesw', 'bigpicturesw', 'votingprp', 0, props.totalVotings, props.totalVotings),\n                shareholdersVotingListResponse = await new EOSIOApi(REACT_APP_EOSIO_CONTRACT_ACCOUNT).getTableRows('bigpicturesw', 'bigpicturesw', 'tokenprp', 0, props.totalVotings, props.totalVotings)\n\n            if (votingListResponse.data.rows.length > 0) {\n                let data = JSON.parse(JSON.stringify(votingListResponse.data.rows))\n                data.map(el => votingList.push(el.data));\n            }\n\n            if (shareholdersVotingListResponse.data.rows.length > 0) {\n                let data = JSON.parse(JSON.stringify(shareholdersVotingListResponse.data.rows))\n                data.map(el => votingList.push(el.data));\n            }\n            if (votingList.length > 0) {\n                votingList.sort((a, b) => new Date(b.created) - new Date(a.created))\n                setStartDate(moment(votingList[votingList.length - 1].created).format(\"MM/DD/YYYY\"))\n            }\n\n            for (j = 0; j < votingList.length; j++) {\n                let item = JSON.parse(JSON.stringify(votingList[j])),\n                    totalVote = item.yes + item.no,\n                    voteDAO = props.daoList.filter((dao) => dao.data.id === item.daoid)[0],\n                    token = voteDAO.data.token.split(' ')[1],\n                    isTokenAvailable = props.daotokensList.filter((dao) => (dao.data.balance).split(' ')[1] === token)\n\n                if (item.question) {\n                    item.type = 'Voting';\n                    item.title = 'Voting';\n                } else {\n                    item.type = 'Shareholders';\n                    item.title = 'Sharevolder';\n                    item.question = `This proposal will distribute ${item.amount} to ${item.user}`\n                }\n\n                console.log(\"item::\",item)\n                console.log(\"token::\",token)\n                console.log(\"isTokenAvailable::\",isTokenAvailable)\n                if (isTokenAvailable.length > 0)\n                    item.canIVote = true\n                else\n                    item.canIVote = false\n\n                item.contentId = j + 1\n                item.yesPerc = totalVote === 0 ? 0 : ((item.yes / totalVote) * 100).toFixed(2)\n                item.noPerc = totalVote === 0 ? 0 : ((item.no / totalVote) * 100).toFixed(2)\n\n                if (moment(moment.utc(item.expires).format()).isAfter(moment.utc().format())) {\n                    item.outcome = 'Pending'\n                    item.status = 'Open'\n                } else {\n                    item.status = 'Closed'\n                    if (item.yesPerc >= voteDAO.data.support) {\n                        item.outcome = 'Passed'\n                        if (!(moment(moment.utc(item.expires).format()).isAfter(moment.utc().format())) && item.type === 'Shareholders' && item.paid === 1) {\n                            item.outcome = 'Passed & Enacted'\n                        }\n                    } else if (item.yesPerc < voteDAO.data.support) {\n                        item.outcome = 'Rejected'\n                    }\n                }\n                data1.push(item)\n                if (j === votingList.length - 1) {\n                    setData1(data1)\n                    setvotinQuestionList(data1)\n                }\n            }\n        } catch (error) {\n            console.log(error)\n        }\n    }\n\n    useEffect(() => {\n        getVotingList()\n        setFilters({ Status: '', Outcome: '', Type: '' })\n        setVotingHeaders(votingHeader1)\n        document.addEventListener('mousedown', handleClickOutside);\n        return () => document.removeEventListener('mousedown', handleClickOutside);\n    }, []);\n    \n    return (\n        <div className=\"voting_main\" ref={myRef} onClick={handleClickOutside}>\n            <div className=\"voting_header\" >\n                {votingHeaders.map((obj, k) =>\n                    <div\n                        id={obj.key}\n                        name={obj.key}\n                        className=\"dropdown voting-status\"\n                        onClick={() => openDropDown(obj)}>\n                        <span className=\"votingstatus-text\">{obj.selectedValue}</span>\n                        <span><i className=\"fa fa-angle-down votingstatus-down\"></i></span>\n                        {openDropBox && activeDroxKey === obj.key &&\n                            <ul className=\"options\" style={obj.style}>\n                                {obj.data.length > 0 && obj.data.map((opt, i) =>\n                                    <li\n                                        key={i}\n                                        data-value={`${opt.value}`}\n                                        onClick={(e) => setSelectedValue(e, opt, obj)}>\n                                        {opt.key}\n                                    </li>\n                                )}\n                            </ul>}\n                    </div>)}\n                {startDate != null &&\n                    <DateRangePicker\n                        onEvent={handleEvent}\n                        onCallback={handleCallback}\n                        initialSettings={{\n                            startDate: selectedDates === null ? startDate : selectedDates.startDate,\n                            endDate: selectedDates === null ? moment().utc().format(\"MM/DD/YYYY\") : selectedDates.startDate\n                        }} >\n                        <div className=\"dropdown voting-status\" style={{ width: 'max-content' }} >\n                            <span className=\"votingstatus-text\" style={{ paddingRight: '51px' }}>\n                                {selectedDates === null ? `Start | End` : `${selectedDates.startDate} | ${'  '}${selectedDates.endDate}`}\n                            </span>\n                            <span><i className=\"fa fa-angle-down votingstatus-down\"></i>\n                            </span>\n                        </div>\n                    </DateRangePicker>}\n            </div>\n            <div className=\"voting_body\">\n                {votinQuestionList.length > 0 && votinQuestionList.map((obj, l) =>\n                    <VotingCard\n                        id={l}\n                        voteQuestionDtls={obj}\n                        votingDtls={votingDtls}\n                        openVotingDtls={(votings) => openVotingDtls(votings)}\n                    />)}\n            </div>\n            {\n                votingDtls && Object.keys(votingDtlsData).length > 0 &&\n                <VotingDetails\n                    show={votingDtls}\n                    votingDtlsData={votingDtlsData}\n                    handleClose={() => handleClose()}\n                    enactAmount={(vote) => enactAmount(vote)}\n                    votedQuestion={(votingData, isVoted) => votedQuestion(votingData, isVoted)}\n                />\n            }\n        </div >\n    )\n}\n\nexport default Voting;"]},"metadata":{},"sourceType":"module"}